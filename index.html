<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Calendario académico 2025-2026</title>
<script src="jquery-3.6.0.min.js"></script>
<style>
body {
  background: #111;
  color: #fff;
  font-family: Arial, sans-serif;
  text-align: center;
}

h1 {
  font-size: 26px;
  margin: 20px 0;
}

.calendario {
  display: grid;
  grid-template-columns: repeat(4, 1fr); /* 4 columnas */
  gap: 10px; /* espacio pequeño entre meses */
  justify-items: stretch; /* que los meses ocupen todo el ancho de la columna */
}

.mes {
  border: 1px solid #333;
  background: #1c1c1c;
  border-radius: 8px;
  width: 100%; /* ocupa todo el ancho de su columna */
  padding: 5px;
}

.mes h2 {
  background: #503685;
  padding: 5px;
  margin: 0 0 4px;
  border-radius: 4px;
  font-size: 14px;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px; /* ligeramente más grande */
}

th {
  background: #222;
  padding: 3px;
}

td {
  border: 1px solid #333;
  width: calc(100% / 7); /* 7 días por fila */
  height: 50px; /* más alto para iconos */
  text-align: center;
  vertical-align: middle; /* centra verticalmente los iconos */
  position: relative;
}

.festivo {
  background: rgba(255, 0, 0, 0.3);
  border-color: rgba(255, 0, 0, 0.5);
}

.add-btn {
  position: absolute;
  bottom: 2px;
  right: 2px;
  font-size: 10px;
  background: #444;
  border: none;
  color: #fff;
  border-radius: 50%;
  width: 16px;
  height: 16px;
  cursor: pointer;
}

.inicial {
  display: inline-block;
  padding: 2px 4px;
  border-radius: 4px;
  font-size: 11px;
  margin: 1px;
  color: #000;
  font-weight: bold;
}

.asignados {
  margin-top: 4px;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 2px; /* espacio entre iconos */
}

select.multiselect {
  position: absolute;
  bottom: 18px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 11px;
  display: none;
  z-index: 10;
}
</style>
</head>
<body>

<h1>Calendario académico 2025-2026</h1>
<div id="calendario" class="calendario"></div>

<script>
let dias = {};
let usuarios = [];
let asignaciones = {};

$.when(
  $.getJSON("holidays.json", function(data) { dias = data; }),
  $.getJSON("users.json", function(data) { usuarios = data.usuarios; })
).done(function() {
  generarCalendario(2025, 2026);
});

const mesesNombres = [
  "Enero","Febrero","Marzo","Abril","Mayo","Junio",
  "Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"
];

function generarCalendario(anioInicio, anioFin) {
  const $contenedor = $("#calendario");
  $contenedor.empty();

  for (let y = anioInicio; y <= anioFin; y++) {
    for (let m = 0; m < 12; m++) {
      const primerDia = new Date(y, m, 1);
      const ultimoDia = new Date(y, m + 1, 0);
      const nombreMes = mesesNombres[m] + " " + y;

      let html = `<div class="mes"><h2>${nombreMes}</h2><table><thead><tr>
      <th>Lu</th><th>Ma</th><th>Mi</th><th>Ju</th><th>Vi</th><th>Sá</th><th>Do</th>
      </tr></thead><tbody><tr>`;

      let diaSemana = (primerDia.getDay() + 6) % 7;
      for (let i = 0; i < diaSemana; i++) html += "<td></td>";

      for (let d = 1; d <= ultimoDia.getDate(); d++) {
        const fecha = `${y}-${String(m + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
        const festivo = dias[fecha] && (dias[fecha].festivo_estatal || dias[fecha].festivo_local);
        html += `<td class="${festivo ? 'festivo' : ''}" data-fecha="${fecha}">
                    <div>${d}</div>
                    <div class="asignados"></div>
                    <button class="add-btn">+</button>
                    <select multiple class="multiselect">
                      ${usuarios.map(u => `<option value="${u.nombre}">${u.nombre}</option>`).join('')}
                    </select>
                 </td>`;
        diaSemana++;
        if (diaSemana === 7 && d < ultimoDia.getDate()) {
          html += "</tr><tr>";
          diaSemana = 0;
        }
      }
      while (diaSemana < 7 && diaSemana !== 0) {
        html += "<td></td>";
        diaSemana++;
      }
      html += "</tr></tbody></table></div>";
      $contenedor.append(html);
    }
  }

  // === Eventos ===
  $(".add-btn").on("click", function(e) {
    e.stopPropagation();
    const $td = $(this).closest("td");
    const $select = $td.find(".multiselect");
    $(".multiselect").not($select).hide();
    $select.toggle();
  });

  $(".multiselect").on("change", function() {
    const $td = $(this).closest("td");
    const fecha = $td.data("fecha");
    const seleccionados = $(this).val();
    asignaciones[fecha] = seleccionados;
    actualizarDia($td, seleccionados);
  });

  $(document).on("click", function() {
    $(".multiselect").hide();
  });
}

function actualizarDia($td, seleccionados) {
  const $contenedor = $td.find(".asignados");
  $contenedor.empty();
  seleccionados.forEach(nombre => {
    const u = usuarios.find(x => x.nombre === nombre);
    if (u) {
      $contenedor.append(`<span class="inicial" style="background:${u.color}">${u.inicial}</span>`);
    }
  });
}
</script>

</body>
</html>


